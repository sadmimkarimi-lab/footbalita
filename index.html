<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>ÙÙˆØªØ¨Ø§Ù„ÛŒØªØ§ âš½ | Ù†Ø³Ø®Ù‡ Ù¾Ø±Ùˆ</title>

  <!-- Eitaa WebApp SDK -->
  <script src="https://developer.eitaa.com/eitaa-web-app.js"></script>

  <style>
    *{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    html,body{height:100%;background:#070b14;color:#fff;overflow:hidden}

    .app{height:100%;display:flex;flex-direction:column;max-width:680px;margin:0 auto;padding:6px;gap:6px}
    .glass{
      background:rgba(255,255,255,.085);
      border:1px solid rgba(255,255,255,.12);
      border-radius:14px;
      padding:6px 8px;
      backdrop-filter:blur(10px);
      box-shadow:0 10px 34px rgba(0,0,0,.22);
    }

    .topbar{display:flex;align-items:center;justify-content:space-between;gap:8px}
    .brand{display:flex;align-items:center;gap:8px;min-width:0}
    .logo{
      width:36px;height:36px;border-radius:12px;display:flex;align-items:center;justify-content:center;
      background:rgba(34,197,94,.22);border:1px solid rgba(34,197,94,.35);
      box-shadow:0 0 18px rgba(34,197,94,.14);
      font-size:16px;flex:0 0 auto;
      animation:logoFloat 3s ease-in-out infinite;
    }
    @keyframes logoFloat{
      0%,100%{transform:translateY(0px) rotate(0deg)}
      50%{transform:translateY(-3px) rotate(5deg)}
    }
    .titles{display:flex;flex-direction:column;gap:1px;min-width:0}
    .name{font-weight:1000;font-size:12.5px;line-height:1.05}
    .tag{opacity:.86;font-size:10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:330px}

    .btn{
      border:none;border-radius:12px;padding:6px 8px;font-weight:1000;cursor:pointer;
      background:rgba(255,255,255,.12);color:#fff;border:1px solid rgba(255,255,255,.14);
      font-size:11px;line-height:1;user-select:none;white-space:nowrap;
      transition:all .15s ease;
    }
    .btn:active{transform:scale(.96)}
    .btn.primary{background:linear-gradient(135deg,#22c55e,#a3e635);color:#071022;border:none;box-shadow:0 4px 12px rgba(34,197,94,.3)}
    .btn.danger{background:rgba(239,68,68,.18);border-color:rgba(239,68,68,.35)}
    .btn.icon{padding:6px 7px;min-width:36px;text-align:center;font-size:13px}
    .btn.pill{border-radius:999px}
    .modeBtn.active{background:rgba(34,197,94,.22);border-color:rgba(34,197,94,.35);box-shadow:0 0 12px rgba(34,197,94,.2)}

    .panel{display:flex;gap:6px;align-items:center;justify-content:space-between}
    .modes{display:flex;gap:6px;flex-wrap:nowrap}

    .hud{
      display:flex;align-items:center;justify-content:space-between;gap:6px
    }
    .pills{display:flex;gap:6px;align-items:center;flex-wrap:nowrap;overflow:auto;scrollbar-width:none}
    .pills::-webkit-scrollbar{display:none}
    .pill{
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.12);
      padding:4px 8px;border-radius:999px;font-weight:1000;font-size:10.5px;
      display:flex;gap:6px;align-items:center;white-space:nowrap;
      transition:all .2s ease;
    }
    .pill strong{font-size:11.5px}
    .scorePill{
      padding:4px 9px;
      border-color:rgba(255,255,255,.18);
      background:rgba(255,255,255,.09);
    }
    .scoreGreen{border-color:rgba(34,197,94,.35);background:rgba(34,197,94,.12)}
    .scoreBlue{border-color:rgba(59,130,246,.35);background:rgba(59,130,246,.12)}
    
    .pill.pulse{animation:pillPulse .5s ease}
    @keyframes pillPulse{
      0%,100%{transform:scale(1)}
      50%{transform:scale(1.08)}
    }

    .stage{
      flex:1;min-height:0;border-radius:18px;overflow:hidden;border:1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(1200px 600px at 50% 90%, rgba(34,197,94,.18), transparent 60%),
        radial-gradient(900px 400px at 50% 15%, rgba(59,130,246,.10), transparent 60%),
        linear-gradient(180deg,#0f1830,#071022);
      position:relative;box-shadow:0 18px 70px rgba(0,0,0,.55)
    }
    canvas{width:100%;height:100%;display:block;touch-action:none}

    .hint{
      opacity:.92;font-size:10.5px;text-align:center;line-height:1.65;
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
      border-radius:14px;padding:6px 8px;
    }

    .toast{
      position:fixed;left:50%;top:10.5%;transform:translateX(-50%);
      background:rgba(0,0,0,.58);border:1px solid rgba(255,255,255,.12);
      padding:9px 10px;border-radius:12px;z-index:99999;
      font-weight:1000;font-size:11px;opacity:0;pointer-events:none;
      transition:opacity .18s ease, transform .18s ease;
      max-width:min(92vw,560px);text-align:center;direction:rtl
    }
    .toast.show{opacity:1;transform:translateX(-50%) translateY(-6px)}

    .overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:14px;background:rgba(0,0,0,.62);z-index:9999;backdrop-filter:blur(4px)}
    .card{
      width:min(520px,100%);background:linear-gradient(180deg,#0f1a33,#0a1124);
      border:1px solid rgba(255,255,255,.12);border-radius:16px;
      box-shadow:0 25px 80px rgba(0,0,0,.6);padding:12px;
      animation:cardPop .25s ease;
    }
    @keyframes cardPop{
      0%{transform:scale(.92);opacity:0}
      100%{transform:scale(1);opacity:1}
    }
    .card h3{margin:0 0 6px;font-size:14px}
    .card p{margin:0 0 10px;font-size:11px;opacity:.92;line-height:1.9}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .row .btn{flex:1}
    .muted{opacity:.85;font-size:10px}

    .goalFx{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.36);z-index:9998;backdrop-filter:blur(2px)}
    .goalFxText{
      padding:14px 18px;border-radius:18px;
      background:linear-gradient(135deg, rgba(34,197,94,.95), rgba(163,230,53,.95));
      color:#071022;font-weight:1000;font-size:28px;
      box-shadow:0 18px 80px rgba(0,0,0,.45);
      text-align:center;
      animation:goalBounce .4s ease;
    }
    @keyframes goalBounce{
      0%{transform:scale(.7);opacity:0}
      60%{transform:scale(1.12)}
      100%{transform:scale(1);opacity:1}
    }
    @keyframes shake{0%{transform:translate(0,0)}25%{transform:translate(2px,-2px)}50%{transform:translate(-2px,2px)}75%{transform:translate(2px,2px)}100%{transform:translate(0,0)}}
    .goal-shake{animation:shake .28s linear}

    .confetti{position:fixed;pointer-events:none;z-index:9997}

    .bottom-ad{
      position:fixed;left:50%;bottom:6px;
      width:min(96%,580px);height:46px;display:none;align-items:center;justify-content:center;
      z-index:99999;border-radius:14px;background:rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.12);backdrop-filter:blur(8px);
      box-shadow:0 12px 50px rgba(0,0,0,.45);overflow:hidden;
      opacity:0;
      transform:translateX(-50%) translateY(10px) scale(.985);
      transition:opacity .22s ease, transform .22s ease;
      pointer-events:none;
    }
    .bottom-ad.show{
      opacity:1;
      transform:translateX(-50%) translateY(0) scale(1);
      pointer-events:auto;
    }
    .bottom-ad img{height:100%;width:100%;object-fit:cover;cursor:pointer}
    .closeAd{
      position:absolute;right:6px;top:6px;width:20px;height:20px;border:none;border-radius:999px;
      background:rgba(0,0,0,.55);color:#fff;font-size:14px;line-height:20px;cursor:pointer;
    }
    .adTag{
      position:absolute;left:8px;top:7px;background:rgba(249,115,22,.92);
      color:#071022;font-weight:1000;border-radius:999px;padding:2px 7px;font-size:10px;
    }

    .tiny{font-size:10px;opacity:.9}
    
    .powerMeter{
      position:absolute;left:50%;bottom:20px;transform:translateX(-50%);
      width:200px;height:8px;background:rgba(0,0,0,.4);
      border-radius:999px;border:1px solid rgba(255,255,255,.2);
      overflow:hidden;opacity:0;pointer-events:none;
      transition:opacity .2s ease;
    }
    .powerMeter.show{opacity:1}
    .powerBar{
      height:100%;background:linear-gradient(90deg,#22c55e,#a3e635,#f59e0b,#ef4444);
      border-radius:999px;width:0%;transition:width .05s linear;
      box-shadow:0 0 10px rgba(34,197,94,.6);
    }

    .combo-display{
      position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
      font-size:48px;font-weight:1000;
      color:#fff;
      text-shadow:0 0 20px rgba(34,197,94,.8),0 0 40px rgba(34,197,94,.5);
      opacity:0;
      pointer-events:none;
      transition:opacity .3s ease;
    }
    .combo-display.show{
      opacity:1;
      animation:comboZoom .5s ease;
    }
    @keyframes comboZoom{
      0%{transform:translate(-50%,-50%) scale(.5)}
      50%{transform:translate(-50%,-50%) scale(1.2)}
      100%{transform:translate(-50%,-50%) scale(1)}
    }
  </style>
</head>

<body>
<div class="app">
  <div class="topbar glass">
    <div class="brand">
      <div class="logo">âš½</div>
      <div class="titles">
        <div class="name">ÙÙˆØªØ¨Ø§Ù„ÛŒØªØ§ Ù¾Ø±Ùˆ</div>
        <div class="tag">Ù†Ø³Ø®Ù‡ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ | ÙÛŒØ²ÛŒÚ© ÙˆØ§Ù‚Ø¹ÛŒ + Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ ğŸ”¥</div>
      </div>
    </div>
    <button class="btn" id="tavitaBtn">Ø·Ø§ÙˆÛŒØªØ§</button>
  </div>

  <div class="panel glass">
    <div class="modes">
      <button class="btn pill modeBtn active" data-mode="solo">ğŸ¯ Ù¾Ù†Ø§Ù„ØªÛŒ</button>
      <button class="btn pill modeBtn" data-mode="pvp">ğŸ‘¥ Ø¯ÙˆÙ†ÙØ±Ù‡</button>
    </div>

    <div style="display:flex;gap:6px;align-items:center;flex-wrap:nowrap">
      <button class="btn icon" id="soundBtn" title="ØµØ¯Ø§">ğŸ”Š</button>
      <button class="btn icon" id="pauseBtn" title="Ù…Ú©Ø«">â¸</button>
      <button class="btn primary" id="restartBtn" title="Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯">â†»</button>
    </div>
  </div>

  <div class="hud glass">
    <div class="pills" id="hudLeft">
      <div class="pill scorePill scoreGreen" id="p1Pill">ğŸŸ¢ <strong id="p1Score">0</strong><span class="tiny">Ø¨Ø§Ø²ÛŒÚ©Ù† Û±</span></div>
      <div class="pill scorePill scoreBlue" id="p2Pill" style="display:none;">ğŸ”µ <strong id="p2Score">0</strong><span class="tiny">Ø¨Ø§Ø²ÛŒÚ©Ù† Û²</span></div>
      <div class="pill">âš½ Ú¯Ù„â€ŒÙ‡Ø§: <strong id="goals">0</strong></div>
      <div class="pill" id="streakPill">ğŸ”¥ Ø§Ø³ØªØ±ÛŒÚ©: <strong id="streak">0</strong>x</div>
      <div class="pill">â± <strong id="time">60</strong>s</div>
    </div>
    <div class="pill" id="modeLabel">Ù¾Ù†Ø§Ù„ØªÛŒ</div>
  </div>

  <div class="stage">
    <canvas id="cv"></canvas>
    <div class="powerMeter" id="powerMeter">
      <div class="powerBar" id="powerBar"></div>
    </div>
    <div class="combo-display" id="comboDisplay"></div>
  </div>

  <div class="hint glass" id="hint">
    Ù¾Ù†Ø§Ù„ØªÛŒ: Ø±ÙˆÛŒ ØªÙˆÙ¾ Ù„Ù…Ø³ Ú©Ù† â†’ <b>Ø¨Ù‡ Ù¾Ø§ÛŒÛŒÙ† Ø¨Ú©Ø´ Ùˆ Ø±Ù‡Ø§ Ú©Ù†</b>.
    Ú¯ÙˆØ´Ù‡â€ŒÙ‡Ø§ + Ø³Ø±Ø¹Øª Ø¨Ø§Ù„Ø§ = Ú¯Ù„ ØªØ¶Ù…ÛŒÙ†ÛŒ ğŸ”¥
  </div>
</div>

<div class="toast" id="toast"></div>

<div class="overlay" id="pauseOverlay">
  <div class="card">
    <h3 id="overlayTitle">Ù…Ú©Ø« â¸</h3>
    <p id="overlayDesc" class="muted">ØªØ¨Ù„ÛŒØº ÙÙ‚Ø· Ø¯Ø± Ù…Ú©Ø«/Ú¯Ù„/Ù¾Ø§ÛŒØ§Ù† Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ âœ…</p>
    <div class="row">
      <button class="btn primary" id="resumeBtn">Ø§Ø¯Ø§Ù…Ù‡</button>
      <button class="btn" id="closePauseBtn">Ø¨Ø³ØªÙ†</button>
    </div>
  </div>
</div>

<div class="goalFx" id="goalFx">
  <div class="goalFxText" id="goalFxText">GOOOAL! âš½ğŸ”¥</div>
</div>

<div id="bottomAd" class="bottom-ad" aria-hidden="true">
  <span class="adTag">Ø§Ø³Ù¾Ø§Ù†Ø³Ø±</span>
  <img id="bottomAdImg" alt="ad">
  <button class="closeAd" id="closeAdBtn" title="Ø¨Ø³ØªÙ†">Ã—</button>
</div>

<script>
(() => {
  // ==================== Eitaa SDK ====================
  const EWA = (window.Eitaa && window.Eitaa.WebApp) ? window.Eitaa.WebApp : null;
  try{
    if(EWA){
      if(typeof EWA.ready==="function") EWA.ready();
      if(typeof EWA.expand==="function") EWA.expand();
      if(typeof EWA.disableVerticalSwipes==="function") EWA.disableVerticalSwipes();
    }
  }catch(e){}

  function openEitaaLinkSafe(url){
    const isEitaa = /^https?:\/\/(www\.)?eitaa\.com\//i.test(url);
    try{
      if(EWA){
        if(isEitaa && typeof EWA.openEitaaLink==="function"){ EWA.openEitaaLink(url); return; }
        if(typeof EWA.openLink==="function"){ EWA.openLink(url); return; }
        if(typeof EWA.openEitaaLink==="function"){ EWA.openEitaaLink(url); return; }
      }
    }catch(e){}
    try{ window.location.assign(url); }catch(e){ window.location.href=url; }
  }

  // ==================== Ads ====================
  const ADS = {
    enabled:true,
    image:"https://cdnfa.com/irangiah/a9be/uploads/ads/tankads.webp",
    link:"https://eitaa.com/tavita_ads",
    autoHideMs:5200,
    minGapSec:14,
    showOnPause:true,
    showOnGoal:true,
    showOnTimeEnd:true,
    showOnWin:true
  };

  const bottomAd = document.getElementById("bottomAd");
  const bottomAdImg = document.getElementById("bottomAdImg");
  const closeAdBtn = document.getElementById("closeAdBtn");
  bottomAdImg.src = ADS.image;

  let adTimer=null;
  function adKey(k){ return "footballita_ad_" + k; }
  function canShowAd(){
    try{
      const last = parseInt(localStorage.getItem(adKey("last")) || "0", 10);
      return (Date.now()-last) >= (ADS.minGapSec*1000);
    }catch(e){ return true; }
  }
  function markShown(){ try{ localStorage.setItem(adKey("last"), String(Date.now())); }catch(e){} }

  function showAd(){
    if(!ADS.enabled) return;
    if(!canShowAd()) return;
    markShown();
    bottomAd.style.display="flex";
    bottomAd.setAttribute("aria-hidden","false");
    requestAnimationFrame(()=>bottomAd.classList.add("show"));
    clearTimeout(adTimer);
    adTimer=setTimeout(hideAd, ADS.autoHideMs);
  }
  function hideAd(){
    bottomAd.classList.remove("show");
    bottomAd.setAttribute("aria-hidden","true");
    clearTimeout(adTimer);
    setTimeout(()=>{ bottomAd.style.display="none"; }, 240);
  }
  bottomAdImg.addEventListener("click", ()=>openEitaaLinkSafe(ADS.link));
  closeAdBtn.addEventListener("click",(e)=>{ e.stopPropagation(); hideAd(); });

  // ==================== UI ====================
  const ui = {
    tavitaBtn: document.getElementById("tavitaBtn"),
    soundBtn: document.getElementById("soundBtn"),
    pauseBtn: document.getElementById("pauseBtn"),
    restartBtn: document.getElementById("restartBtn"),
    resumeBtn: document.getElementById("resumeBtn"),
    closePauseBtn: document.getElementById("closePauseBtn"),
    pauseOverlay: document.getElementById("pauseOverlay"),
    overlayTitle: document.getElementById("overlayTitle"),
    overlayDesc: document.getElementById("overlayDesc"),
    modeBtns: [...document.querySelectorAll(".modeBtn")],
    modeLabel: document.getElementById("modeLabel"),
    hint: document.getElementById("hint"),
    p1Score: document.getElementById("p1Score"),
    p2Score: document.getElementById("p2Score"),
    p2Pill: document.getElementById("p2Pill"),
    p1Pill: document.getElementById("p1Pill"),
    goals: document.getElementById("goals"),
    streak: document.getElementById("streak"),
    streakPill: document.getElementById("streakPill"),
    time: document.getElementById("time"),
    powerMeter: document.getElementById("powerMeter"),
    powerBar: document.getElementById("powerBar"),
    comboDisplay: document.getElementById("comboDisplay"),
  };

  ui.tavitaBtn.addEventListener("click", ()=>openEitaaLinkSafe("https://eitaa.com/tavita"));

  // toast
  const toastEl=document.getElementById("toast");
  let toastTimer=null;
  function toast(t){
    toastEl.textContent=t;
    toastEl.classList.add("show");
    clearTimeout(toastTimer);
    toastTimer=setTimeout(()=>toastEl.classList.remove("show"),980);
  }

  // Combo display
  function showCombo(text){
    ui.comboDisplay.textContent=text;
    ui.comboDisplay.classList.add("show");
    setTimeout(()=>ui.comboDisplay.classList.remove("show"), 800);
  }

  // Goal FX with enhanced confetti
  const goalFx=document.getElementById("goalFx");
  const goalFxText=document.getElementById("goalFxText");
  const stageEl=document.querySelector(".stage");
  let slowmo=1;
  
  function createConfetti(){
    const colors = ['#22c55e','#a3e635','#fbbf24','#f59e0b','#3b82f6','#8b5cf6','#ec4899'];
    for(let i=0;i<80;i++){
      const conf = document.createElement('div');
      conf.className = 'confetti';
      const size = 6 + Math.random()*6;
      conf.style.cssText = `
        position:fixed;
        left:${Math.random()*100}%;
        top:-20px;
        width:${size}px;
        height:${size}px;
        background:${colors[Math.floor(Math.random()*colors.length)]};
        opacity:${0.7+Math.random()*0.3};
        border-radius:${Math.random()>0.5?'50%':'2px'};
        transform:rotate(${Math.random()*360}deg);
      `;
      document.body.appendChild(conf);
      
      const duration = 2500 + Math.random()*1500;
      const endY = window.innerHeight + 100;
      const endX = parseFloat(conf.style.left) + (Math.random()*300-150);
      
      conf.animate([
        {transform:`translate(0,0) rotate(0deg)`, opacity:1},
        {transform:`translate(${endX}px,${endY/2}px) rotate(${Math.random()*360}deg)`, opacity:0.8, offset:0.5},
        {transform:`translate(${endX}px,${endY}px) rotate(${Math.random()*720}deg)`, opacity:0}
      ], {
        duration,
        easing:'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
      }).onfinish = ()=>conf.remove();
    }
  }
  
  function goalHype(text){
    goalFxText.textContent=text||"GOOOAL! âš½ğŸ”¥";
    goalFx.style.display="flex";
    stageEl.classList.add("goal-shake");
    setTimeout(()=>stageEl.classList.remove("goal-shake"),300);
    slowmo=0.5; setTimeout(()=>slowmo=1,600);
    createConfetti();
    if(ADS.showOnGoal) showAd();
    sfxGoal(); vibr(40);
    setTimeout(()=>goalFx.style.display="none",700);
  }

  // Enhanced sound system
  let soundOn=true;
  let AC=null;
  function getAC(){ try{ if(!AC) AC=new (window.AudioContext||window.webkitAudioContext)(); return AC; }catch(e){ return null; } }
  
  function beep(freq=740,dur=0.06,vol=0.03,type="sine"){
    if(!soundOn) return;
    const ac=getAC(); if(!ac) return;
    try{
      const o=ac.createOscillator(), g=ac.createGain();
      o.connect(g); g.connect(ac.destination);
      o.frequency.value=freq; o.type=type;
      g.gain.setValueAtTime(vol,ac.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001, ac.currentTime+dur);
      o.start(); o.stop(ac.currentTime+dur);
    }catch(e){}
  }
  
  function vibr(ms=16){ try{ navigator.vibrate && navigator.vibrate(ms); }catch(e){} }
  function sfxKick(){ 
    beep(600,0.055,0.04,"triangle"); 
    setTimeout(()=>beep(450,0.035,0.025,"sine"),25);
  }
  function sfxSave(){ 
    beep(220,0.110,0.035,"sawtooth");
    setTimeout(()=>beep(180,0.08,0.028,"square"),60);
  }
  function sfxMiss(){ beep(165,0.120,0.032,"square"); }
  function sfxPost(){ 
    beep(380,0.065,0.040,"square"); 
    setTimeout(()=>beep(280,0.075,0.035,"square"),80);
  }
  function sfxGoal(){ 
    beep(1100,0.095,0.035,"triangle"); 
    setTimeout(()=>beep(1380,0.095,0.032,"triangle"),100);
    setTimeout(()=>beep(1650,0.095,0.029,"triangle"),200);
    setTimeout(()=>beep(1980,0.110,0.026,"sine"),300);
  }

  ui.soundBtn.addEventListener("click", ()=>{ soundOn=!soundOn; syncUI(); toast(soundOn?"ğŸ”Š ØµØ¯Ø§ Ø±ÙˆØ´Ù†":"ğŸ”‡ ØµØ¯Ø§ Ø®Ø§Ù…ÙˆØ´"); });

  // ==================== pause / overlay ====================
  let paused=false, running=true, inEndScreen=false;
  let overlayType="pause";

  function openOverlay(title, desc, type){
    overlayType = type || "pause";
    ui.overlayTitle.textContent=title;
    ui.overlayDesc.textContent=desc || " ";
    ui.pauseOverlay.style.display="flex";
    ui.resumeBtn.textContent = (overlayType==="end") ? "Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯" : "Ø§Ø¯Ø§Ù…Ù‡";
  }
  function closeOverlay(){ ui.pauseOverlay.style.display="none"; }

  function openPause(){
    paused=true; inEndScreen=false;
    openOverlay("Ù…Ú©Ø« â¸","ØªØ¨Ù„ÛŒØº ÙÙ‚Ø· Ø¯Ø± Ù…Ú©Ø«/Ú¯Ù„/Ù¾Ø§ÛŒØ§Ù† Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ âœ…","pause");
    syncUI();
    if(ADS.showOnPause) showAd();
  }

  function hardRestart(){
    closeOverlay();
    hideAd();
    paused=false; running=true; inEndScreen=false;
    timeLeft=60;
    if(mode===MODES.solo) soloResetAll(); else pvpResetAll();
    syncUI();
  }

  function resume(){
    if(overlayType==="end" || inEndScreen || !running){
      hardRestart();
      return;
    }
    closeOverlay(); paused=false; inEndScreen=false;
    hideAd(); syncUI();
  }

  ui.pauseBtn.addEventListener("click", ()=> paused ? resume() : openPause());
  ui.resumeBtn.addEventListener("click", resume);
  ui.closePauseBtn.addEventListener("click", ()=>{ closeOverlay(); hideAd(); });
  ui.pauseOverlay.addEventListener("click",(e)=>{ if(e.target===ui.pauseOverlay){ closeOverlay(); hideAd(); } });

  // ==================== Canvas ====================
  const cv=document.getElementById("cv");
  const ctx=cv.getContext("2d");
  let W=0,H=0,DPR=1;

  function resize(){
    const r=cv.getBoundingClientRect();
    DPR=Math.min(2, window.devicePixelRatio||1);
    W=Math.max(10, r.width);
    H=Math.max(10, r.height);
    cv.width=Math.floor(W*DPR);
    cv.height=Math.floor(H*DPR);
    ctx.setTransform(DPR,0,0,DPR,0,0);
    computeSizes();
  }
  addEventListener("resize", resize);

  function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }
  function dist(ax,ay,bx,by){ return Math.hypot(ax-bx, ay-by); }
  function circleRectHit(cx,cy,cr, rx,ry,rw,rh){
    const nx=clamp(cx,rx,rx+rw);
    const ny=clamp(cy,ry,ry+rh);
    return dist(cx,cy,nx,ny) <= cr;
  }
  function toLocal(e){
    const r=cv.getBoundingClientRect();
    return {x:e.clientX-r.left, y:e.clientY-r.top};
  }

  // ==================== Enhanced Draw helpers ====================
  function drawSoccerBall(x,y,r,spin=0){
    ctx.save(); 
    ctx.translate(x,y); 
    ctx.rotate(spin*0.4);

    // Enhanced shadow with glow
    ctx.globalAlpha=0.4;
    ctx.fillStyle="#000";
    ctx.beginPath(); 
    ctx.arc(r*0.2,r*0.2,r*1.1,0,Math.PI*2); 
    ctx.fill();
    ctx.globalAlpha=1;

    // Ball glow effect
    const glowGrad = ctx.createRadialGradient(0,0,r*0.8,0,0,r*1.3);
    glowGrad.addColorStop(0,"transparent");
    glowGrad.addColorStop(0.7,"transparent");
    glowGrad.addColorStop(1,"rgba(255,255,255,.15)");
    ctx.fillStyle=glowGrad;
    ctx.beginPath(); 
    ctx.arc(0,0,r*1.3,0,Math.PI*2); 
    ctx.fill();

    // Main ball with enhanced gradient
    const base=ctx.createRadialGradient(-r*0.4,-r*0.5,r*0.1,0,0,r);
    base.addColorStop(0,"#ffffff");
    base.addColorStop(0.4,"#f8fafc");
    base.addColorStop(0.7,"#e2e8f0");
    base.addColorStop(1,"#cbd5e1");
    ctx.fillStyle=base;
    ctx.beginPath(); 
    ctx.arc(0,0,r,0,Math.PI*2); 
    ctx.fill();

    // Pentagon pattern with better styling
    ctx.lineWidth=Math.max(1.5, r*0.07);
    ctx.strokeStyle="rgba(15,23,42,.60)";
    ctx.fillStyle="#0f172a";

    // Center pentagon
    ctx.beginPath();
    for(let i=0;i<5;i++){
      const a=-Math.PI/2+i*(Math.PI*2/5);
      const px=Math.cos(a)*r*0.28, py=Math.sin(a)*r*0.28;
      if(i===0) ctx.moveTo(px,py); else ctx.lineTo(px,py);
    }
    ctx.closePath(); 
    ctx.fill(); 
    ctx.stroke();

    // Outer pentagons
    for(let k=0;k<5;k++){
      const ang=-Math.PI/2+k*(Math.PI*2/5);
      const cx=Math.cos(ang)*r*0.56, cy=Math.sin(ang)*r*0.56;
      ctx.beginPath();
      for(let i=0;i<5;i++){
        const a=ang+(i*(Math.PI*2/5))+Math.PI/5;
        const px=cx+Math.cos(a)*r*0.19, py=cy+Math.sin(a)*r*0.19;
        if(i===0) ctx.moveTo(px,py); else ctx.lineTo(px,py);
      }
      ctx.closePath(); 
      ctx.fill(); 
      ctx.stroke();
    }

    // Highlight
    ctx.globalAlpha=0.35;
    ctx.fillStyle="#fff";
    ctx.beginPath(); 
    ctx.arc(-r*0.35,-r*0.45,r*0.28,0,Math.PI*2); 
    ctx.fill();
    ctx.globalAlpha=1;

    ctx.restore();
  }

  function drawField(){
    // Base grass
    ctx.fillStyle="#0a3a2b"; 
    ctx.fillRect(0,0,W,H);

    // Enhanced grass pattern
    ctx.globalAlpha=0.12;
    for(let i=0;i<12;i++){
      ctx.fillStyle=(i%2===0)?"rgba(255,255,255,.8)":"rgba(0,0,0,.6)";
      ctx.fillRect(0,(H/12)*i,W,H/12);
    }
    ctx.globalAlpha=1;

    // Multiple gradient overlays for depth
    const g1=ctx.createRadialGradient(W/2,H*0.95,50,W/2,H*0.95,Math.max(W,H)*0.8);
    g1.addColorStop(0,"rgba(34,197,94,.22)");
    g1.addColorStop(1,"rgba(0,0,0,.35)");
    ctx.fillStyle=g1; 
    ctx.fillRect(0,0,W,H);

    const g2=ctx.createRadialGradient(W/2,H*0.05,50,W/2,H*0.05,Math.max(W,H)*0.6);
    g2.addColorStop(0,"rgba(59,130,246,.12)");
    g2.addColorStop(1,"transparent");
    ctx.fillStyle=g2; 
    ctx.fillRect(0,0,W,H);

    // Enhanced border
    ctx.strokeStyle="rgba(255,255,255,.85)";
    ctx.lineWidth=2.5;
    ctx.shadowColor="rgba(255,255,255,.5)";
    ctx.shadowBlur=12;
    ctx.strokeRect(18,18,W-36,H-36);
    ctx.shadowBlur=0;

    // Center circle
    ctx.globalAlpha=0.25;
    ctx.strokeStyle="rgba(255,255,255,.7)";
    ctx.lineWidth=2;
    ctx.beginPath();
    ctx.arc(W/2, H/2, 50, 0, Math.PI*2);
    ctx.stroke();
    ctx.globalAlpha=1;
  }

  function rr(x,y,w,h,r){
    if(!ctx.roundRect){
      ctx.beginPath(); ctx.rect(x,y,w,h); return;
    }
    ctx.beginPath(); ctx.roundRect(x,y,w,h,r);
  }

  function drawGoalFrame({x,y,w,h,depth,flip,ripple=null,glow="rgba(255,255,255,.3)"}){
    ctx.save();

    // Enhanced 3D shadow
    ctx.globalAlpha=0.25;
    ctx.fillStyle="rgba(0,0,0,.75)";
    const dy = flip ? -depth : depth;
    const shadowOffset = flip ? -8 : 8;
    rr(x+8, y+h+dy+shadowOffset-8, w-16, 16, 12);
    ctx.fill();
    ctx.globalAlpha=1;

    // Enhanced goal frame with double glow
    ctx.shadowColor=glow;
    ctx.shadowBlur=16;
    ctx.lineWidth=5;
    ctx.strokeStyle="rgba(255,255,255,.98)";
    ctx.beginPath();
    ctx.moveTo(x, y+h);
    ctx.lineTo(x, y);
    ctx.lineTo(x+w, y);
    ctx.lineTo(x+w, y+h);
    ctx.stroke();
    
    // Inner glow
    ctx.shadowBlur=8;
    ctx.lineWidth=3;
    ctx.strokeStyle="rgba(255,255,255,.6)";
    ctx.stroke();
    ctx.shadowBlur=0;

    // Enhanced net with better 3D effect
    ctx.globalAlpha=0.28;
    ctx.lineWidth=1.2;
    ctx.strokeStyle="rgba(255,255,255,.7)";
    const step=10;
    const netTopY = flip ? (y+h-8) : (y+8);
    const netBotY = flip ? (y - depth) : (y+h+depth);

    // Vertical net lines
    for(let xx=x+12; xx<=x+w-12; xx+=step){
      const offset = ((xx-x)/(w))*12;
      ctx.beginPath();
      ctx.moveTo(xx, netTopY);
      ctx.lineTo(xx-offset, netBotY);
      ctx.stroke();
    }
    
    // Horizontal net lines
    const total = h+depth;
    for(let i=0;i<=total;i+=step){
      ctx.beginPath();
      const yy = flip ? (y+h-i) : (y+i);
      const curve = Math.sin((i/total)*Math.PI)*4;
      ctx.moveTo(x+10, yy);
      ctx.quadraticCurveTo(x+w/2, yy-curve, x+w-10, yy);
      ctx.stroke();
    }
    ctx.globalAlpha=1;

    // Super enhanced ripple effect
    if(ripple){
      // Primary ripple
      ctx.globalAlpha=Math.max(0, 0.75 - ripple.age*1.2);
      ctx.strokeStyle="rgba(34,197,94,.98)";
      ctx.lineWidth=3.5;
      ctx.shadowColor="rgba(34,197,94,.8)";
      ctx.shadowBlur=15;
      ctx.beginPath();
      ctx.arc(ripple.x, ripple.y, 12 + ripple.age*200, 0, Math.PI*2);
      ctx.stroke();
      
      // Secondary ripple
      ctx.globalAlpha=Math.max(0, 0.5 - ripple.age*1.4);
      ctx.lineWidth=2;
      ctx.shadowBlur=10;
      ctx.beginPath();
      ctx.arc(ripple.x, ripple.y, 25 + ripple.age*250, 0, Math.PI*2);
      ctx.stroke();
      
      // Tertiary ripple
      ctx.globalAlpha=Math.max(0, 0.3 - ripple.age*1.6);
      ctx.lineWidth=1;
      ctx.shadowBlur=5;
      ctx.beginPath();
      ctx.arc(ripple.x, ripple.y, 40 + ripple.age*300, 0, Math.PI*2);
      ctx.stroke();
      
      ctx.shadowBlur=0;
      ctx.globalAlpha=1;
    }

    ctx.restore();
  }

  // ==================== Sizes ====================
  const S = {
    margin:18,
    soloGoalW:240,
    soloGoalH:56,
    soloGoalDepth:32,
    pvpGoalW:200,
    pvpGoalH:28,
    pvpGoalDepth:22,
  };
  function computeSizes(){
    S.soloGoalW = clamp(Math.floor(W*0.50), 210, 300);
    S.pvpGoalW  = clamp(Math.floor(W*0.38), 160, 240);
  }

  // ==================== Modes & timer ====================
  const MODES={solo:"solo",pvp:"pvp"};
  let mode=MODES.solo;
  let timeLeft=60, lastT=performance.now();

  // ==================== SOLO (Enhanced Penalty) ====================
  const solo = {
    player:{x:0,y:0,r:18},
    ball:{x:0,y:0,r:12,vx:0,vy:0,spin:0,stuck:true,trail:[]},
    keeper:{
      x:0,y:0,w:88,h:30,headR:10,
      react:0.48,targetX:0,diveT:0,
      saveCooldown:0,_cx:0,_cy:0,
      anticipation:0
    },
    ripple:null,
    particles:[],
    score:0,
    goals:0,
    streak:0,
    shotAge:0,
    resolving:false,
    lastOutcome:"",
    bestStreak:0,
    totalShots:0,
    accuracy:0
  };

  let soloNonGoalStreak=0;

  function soloResetShot(){
    solo.player.x=W/2; solo.player.y=H*0.82;

    solo.ball.stuck=true;
    solo.ball.vx=solo.ball.vy=0;
    solo.ball.spin=0;
    solo.ball.trail.length=0;
    solo.ball.x=solo.player.x;
    solo.ball.y=solo.player.y-(solo.player.r+solo.ball.r+6);

    solo.keeper.y=S.margin+62;
    solo.keeper.x=W/2;
    solo.keeper.targetX=W/2;
    solo.keeper.diveT=0;
    solo.keeper.saveCooldown=0;
    solo.keeper.anticipation=0;
    solo.keeper._cx=solo.keeper.x;
    solo.keeper._cy=solo.keeper.y;

    solo.ripple=null;
    solo.particles.length=0;
    solo.shotAge=0;
    solo.resolving=false;
  }

  function soloResetAll(){
    solo.score=0; solo.goals=0; solo.streak=0; solo.lastOutcome="";
    solo.bestStreak=0; solo.totalShots=0; solo.accuracy=0;
    soloNonGoalStreak=0;
    soloResetShot();
  }

  function keeperDifficulty(){
    const s = clamp(solo.streak,0,12);
    return {
      react: clamp(0.46 + s*0.015, 0.46, 0.64),
      chaos: clamp(14 - s*0.9, 2, 14),
      centerBias: clamp(0.24 + s*0.012, 0.24, 0.35),
      anticipation: clamp(s*0.08, 0, 0.85)
    };
  }

  function soloCommitDive(){
    const g = keeperDifficulty();
    solo.keeper.react = g.react;
    solo.keeper.anticipation = g.anticipation;

    const gx1=(W-S.soloGoalW)/2;
    const gx2=gx1+S.soloGoalW;

    const aim = solo._predictedAimX || (W/2);
    const spinEffect = Math.abs(solo.ball.spin) * 8;
    const curveNoise = (Math.random()*2-1) * (5 + spinEffect);
    const chaos = (Math.random()*2-1) * g.chaos;
    
    // Anticipation makes keeper predict curve better
    const anticipatedCurve = solo.ball.spin * 15 * g.anticipation;

    let predict = aim + chaos + curveNoise + anticipatedCurve;
    predict = clamp(predict, gx1+solo.keeper.w/2+12, gx2-solo.keeper.w/2-12);
    solo.keeper.targetX=predict;

    solo.keeper.saveCooldown=0.12;
  }

  function soloStepKeeper(dt){
    const k = clamp(dt*60, 0, 2.5);
    solo.keeper.x += (solo.keeper.targetX - solo.keeper.x) * solo.keeper.react * k;

    if(!solo.ball.stuck) solo.keeper.diveT = clamp(solo.keeper.diveT + 0.09*k, 0, 1);
    else                 solo.keeper.diveT = clamp(solo.keeper.diveT - 0.14*k, 0, 1);

    const dx = (solo.keeper.targetX - W/2) * 0.22 * solo.keeper.diveT;
    const dy = -solo.keeper.diveT * 12;
    solo.keeper._cx = solo.keeper.x + dx;
    solo.keeper._cy = solo.keeper.y + dy;
  }

  function soloFinish(outcome){
    if(solo.resolving) return;
    solo.resolving=true;
    solo.lastOutcome = outcome || "";

    solo.ball.stuck=true;
    solo.ball.vx=solo.ball.vy=0;

    setTimeout(()=>soloResetShot(), 300);
  }

  function soloShoot(dx,dy,mag){
    hideAd();
    if(!solo.ball.stuck || solo.resolving) return;

    if(mag < 140){
      toast("ğŸ‘† Ù…Ø­Ú©Ù…â€ŒØªØ± Ø¨Ú©Ø´");
      return;
    }

    solo.ball.stuck=false;
    solo.shotAge=0;
    solo.resolving=false;
    solo.totalShots++;

    const power = clamp(mag, 140, 650);
    const base  = power * 0.030;

    const nx=dx/(power||1), ny=dy/(power||1);

    solo.ball.vx = nx * base;
    solo.ball.vy = ny * base;

    solo.ball.spin = clamp(nx*4.2, -4.5, 4.5);

    const gx1=(W-S.soloGoalW)/2;
    const mouthY = (S.margin+18) + S.soloGoalH;
    const t = Math.max(0.02, (solo.ball.y - mouthY) / Math.max(0.001, -solo.ball.vy));
    solo._predictedAimX = clamp(solo.ball.x + solo.ball.vx*t, gx1+12, gx1+S.soloGoalW-12);

    solo.score += 1;
    sfxKick(); vibr(12);

    soloCommitDive();
  }

  function soloMakeParticles(x,y){
    for(let i=0;i<60;i++){
      const angle = (Math.random()*Math.PI*2);
      const speed = 3 + Math.random()*6;
      solo.particles.push({
        x,y,
        vx:Math.cos(angle)*speed,
        vy:Math.sin(angle)*speed - Math.random()*2,
        a:1, 
        life:0.8+Math.random()*1.2,
        size:2+Math.random()*4,
        color:`hsl(${120+Math.random()*60}, 100%, ${50+Math.random()*20}%)`
      });
    }
  }

  function soloUpdate(dt){
    timeLeft -= dt;
    if(timeLeft<=0){
      timeLeft=0; running=false; paused=true;
      inEndScreen=true;
      
      const acc = solo.totalShots > 0 ? Math.round((solo.goals/solo.totalShots)*100) : 0;
      openOverlay("Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ â±",`ğŸ¯ Ú¯Ù„â€ŒÙ‡Ø§: ${solo.goals} | ğŸ“Š Ø¯Ù‚Øª: ${acc}% | ğŸ”¥ Ø¨Ù‡ØªØ±ÛŒÙ† Ø§Ø³ØªØ±ÛŒÚ©: ${solo.bestStreak}x`,"end");
      if(ADS.showOnTimeEnd) showAd();
      return;
    }

    soloStepKeeper(dt);

    for(let i=solo.particles.length-1;i>=0;i--){
      const p=solo.particles[i];
      p.life-=dt;
      p.x += p.vx*(dt*60);
      p.y += p.vy*(dt*60);
      p.vy += 0.22*(dt*60);
      p.a *= 0.95;
      if(p.life<=0) solo.particles.splice(i,1);
    }
    if(solo.ripple){
      solo.ripple.age += dt;
      if(solo.ripple.age > 0.9) solo.ripple=null;
    }

    if(solo.ball.stuck) return;

    solo.shotAge += dt;
    if(solo.shotAge > 2.5){
      solo.streak=0;
      soloNonGoalStreak++;
      sfxMiss(); vibr(16); toast("ğŸ˜… Ø¯ÛŒØ± Ø´Ø¯!");
      if(soloNonGoalStreak>=2) showAd();
      soloFinish("timeout");
      return;
    }

    solo.keeper.saveCooldown = Math.max(0, solo.keeper.saveCooldown - dt);

    if(solo.ball.vy < 0){
      const nearGoal = clamp(1 - (solo.ball.y / (H*0.65)), 0, 1);
      const curveStrength = 0.058 + nearGoal*0.025;
      solo.ball.vx += solo.ball.spin * curveStrength * (dt*60);
      
      // Add slight turbulence
      solo.ball.vx += (Math.random()*2-1) * 0.008 * (dt*60);
      solo.ball.vy += (Math.random()*2-1) * 0.006 * (dt*60);
    }

    solo.ball.x += solo.ball.vx*(dt*60);
    solo.ball.y += solo.ball.vy*(dt*60);
    solo.ball.vx *= 0.993;
    solo.ball.vy *= 0.993;
    solo.ball.spin *= 0.991;

    solo.ball.trail.push({x:solo.ball.x,y:solo.ball.y,a:1});
    if(solo.ball.trail.length>28) solo.ball.trail.shift();
    for(const t of solo.ball.trail) t.a *= 0.91;

    const gx1=(W-S.soloGoalW)/2;
    const gy=S.margin+18;
    const gx2=gx1+S.soloGoalW;
    const mouthY = gy + S.soloGoalH;

    const postLx = gx1;
    const postRx = gx2;

    const kx=solo.keeper._cx, ky=solo.keeper._cy;
    const body={x:kx-solo.keeper.w/2, y:ky-solo.keeper.h/2, w:solo.keeper.w, h:solo.keeper.h};
    const head={x:kx, y:ky-solo.keeper.h/2-solo.keeper.headR+2, r:solo.keeper.headR};

    const crossbarY = gy;
    const nearX = (solo.ball.x >= postLx - 8 && solo.ball.x <= postRx + 8);
    const hitCrossbar = nearX && (Math.abs((solo.ball.y - solo.ball.r) - crossbarY) < 7) && solo.ball.vy < 0;

    const hitLeftPost  = Math.abs((solo.ball.x - solo.ball.r) - postLx) < 7 && (solo.ball.y < mouthY+20);
    const hitRightPost = Math.abs((solo.ball.x + solo.ball.r) - postRx) < 7 && (solo.ball.y < mouthY+20);

    if(hitCrossbar || hitLeftPost || hitRightPost){
      sfxPost(); vibr(14); toast("ğŸ¥¶ ØªÛŒØ± Ø¯Ø±ÙˆØ§Ø²Ù‡!");
      solo.streak=0;
      soloNonGoalStreak++;
      if(soloNonGoalStreak>=2) showAd();
      if(hitCrossbar) solo.ball.vy = Math.abs(solo.ball.vy) * 0.7;
      if(hitLeftPost || hitRightPost) solo.ball.vx *= -0.8;
      soloFinish("post");
      return;
    }

    const hitBody = circleRectHit(solo.ball.x,solo.ball.y,solo.ball.r, body.x,body.y,body.w,body.h);
    const hitHead = dist(solo.ball.x,solo.ball.y, head.x,head.y) <= (solo.ball.r+head.r);

    if(solo.keeper.saveCooldown<=0 && (hitBody || hitHead)){
      solo.streak=0;
      soloNonGoalStreak++;
      sfxSave(); vibr(20); toast("ğŸ§¤ Ø³ÛŒÙˆ ØªÙˆØ³Ø· Ø¯Ø±ÙˆØ§Ø²Ù‡â€ŒØ¨Ø§Ù†!");
      if(soloNonGoalStreak>=2) showAd();
      soloFinish("save");
      return;
    }

    const insideMouthX = (solo.ball.x >= gx1+12 && solo.ball.x <= gx2-12);
    const crossesMouth = (solo.ball.y - solo.ball.r) <= mouthY && solo.ball.vy < 0;

    const g = keeperDifficulty();
    const gxMid = gx1 + S.soloGoalW/2;
    const centerHard = Math.abs(solo.ball.x - gxMid) < (S.soloGoalW * g.centerBias);

    const speed = Math.hypot(solo.ball.vx, solo.ball.vy);
    const strongEnough = speed > 3.8;

    if(crossesMouth && insideMouthX){
      if(!strongEnough){
        solo.streak=0; soloNonGoalStreak++;
        sfxMiss(); toast("ğŸ’¨ Ø¶Ø¹ÛŒÙ Ø¨ÙˆØ¯!");
        if(soloNonGoalStreak>=2) showAd();
        soloFinish("weak"); return;
      }
      if(centerHard){
        solo.streak=0; soloNonGoalStreak++;
        sfxSave(); toast("ğŸ§¤ ÙˆØ³Ø· Ø¢Ø³ÙˆÙ† Ø¨ÙˆØ¯!");
        if(soloNonGoalStreak>=2) showAd();
        soloFinish("centerSaved"); return;
      }

      solo.goals++;
      solo.streak++;
      if(solo.streak > solo.bestStreak) solo.bestStreak = solo.streak;
      soloNonGoalStreak=0;

      const baseScore = 15;
      const streakBonus = Math.min(30, solo.streak*3);
      const cornerBonus = Math.abs(solo.ball.x - gxMid) > (S.soloGoalW*0.35) ? 10 : 0;
      solo.score += baseScore + streakBonus + cornerBonus;

      solo.ripple = {x:solo.ball.x, y:mouthY+10, age:0};
      soloMakeParticles(solo.ball.x, mouthY+12);

      ui.p1Pill.classList.add('pulse');
      setTimeout(()=>ui.p1Pill.classList.remove('pulse'), 500);

      if(solo.goals>0 && solo.goals%3===0) showAd();

      let goalText = "Ú¯Ù„Ù„Ù„Ù„! âš½ğŸ”¥";
      if(solo.streak>=10) goalText = "ğŸŒŸ Ø®Ø¯Ø§ÛŒÛŒ! âš½ğŸ‘‘";
      else if(solo.streak>=7) goalText = "ğŸ”¥ Ø§ÙØ³Ø§Ù†Ù‡â€ŒØ§ÛŒ! âš½ğŸš€";
      else if(solo.streak>=5) goalText = "â­ ÙÙˆÙ‚â€ŒØ§Ù„Ø¹Ø§Ø¯Ù‡! âš½ğŸ’«";
      else if(solo.streak>=3) goalText = "Ø³ÙˆÙ¾Ø± Ú¯Ù„! âš½â­";
      
      if(solo.streak>=3) showCombo(`${solo.streak}x COMBO! ğŸ”¥`);
      
      goalHype(goalText);
      soloFinish("goal");
      return;
    }

    const minX=S.margin+solo.ball.r, maxX=W-S.margin-solo.ball.r;
    const minY=S.margin+solo.ball.r, maxY=H-S.margin-solo.ball.r;

    if(solo.ball.x<minX){ solo.ball.x=minX; solo.ball.vx*=-0.87; solo.ball.spin*=-0.65; }
    if(solo.ball.x>maxX){ solo.ball.x=maxX; solo.ball.vx*=-0.87; solo.ball.spin*=-0.65; }
    if(solo.ball.y<minY){ solo.ball.y=minY; solo.ball.vy*=-0.87; }

    if(solo.ball.y>maxY){
      solo.streak=0;
      soloNonGoalStreak++;
      sfxMiss(); vibr(18); toast("ğŸ˜… Ø§ÙˆØª Ø´Ø¯!");
      if(soloNonGoalStreak>=2) showAd();
      soloFinish("out");
    }
  }

  function soloDraw(drag){
    drawField();

    const gx1=(W-S.soloGoalW)/2;
    const gy=S.margin+18;

    drawGoalFrame({x:gx1,y:gy,w:S.soloGoalW,h:S.soloGoalH,depth:S.soloGoalDepth,flip:false,ripple:solo.ripple});

    // Penalty box
    ctx.globalAlpha=0.6;
    ctx.strokeStyle="rgba(255,255,255,.45)";
    ctx.lineWidth=2.5;
    ctx.strokeRect(W/2 - S.soloGoalW*0.85, S.margin+8, S.soloGoalW*1.7, 150);
    ctx.globalAlpha=1;

    // Enhanced goalkeeper with animation
    const x=solo.keeper._cx, y=solo.keeper._cy;

    // Shadow
    ctx.globalAlpha=0.28; 
    ctx.fillStyle="#000";
    ctx.beginPath(); 
    ctx.ellipse(x, y+28, 42, 12, 0, 0, Math.PI*2); 
    ctx.fill();
    ctx.globalAlpha=1;

    // Body with better gradient
    const bodyG=ctx.createLinearGradient(x-70,y-30,x+70,y+30);
    bodyG.addColorStop(0,"rgba(59,130,246,.98)");
    bodyG.addColorStop(0.5,"rgba(96,165,250,.92)");
    bodyG.addColorStop(1,"rgba(147,197,253,.75)");
    ctx.fillStyle=bodyG;
    rr(x-solo.keeper.w/2, y-solo.keeper.h/2, solo.keeper.w, solo.keeper.h, 14);
    ctx.fill();

    // Body highlight
    ctx.globalAlpha=0.25;
    ctx.fillStyle="#fff";
    rr(x-solo.keeper.w/2+5, y-solo.keeper.h/2+3, solo.keeper.w*0.4, solo.keeper.h*0.6, 10);
    ctx.fill();
    ctx.globalAlpha=1;

    // Enhanced head
    const skin=ctx.createRadialGradient(x-5,y-14,2,x,y-10,18);
    skin.addColorStop(0,"rgba(255,230,200,.98)");
    skin.addColorStop(0.6,"rgba(240,200,165,.96)");
    skin.addColorStop(1,"rgba(220,180,140,.94)");
    ctx.fillStyle=skin;
    ctx.beginPath(); 
    ctx.arc(x, y-solo.keeper.h/2-solo.keeper.headR+2, solo.keeper.headR, 0, Math.PI*2); 
    ctx.fill();

    // Face details
    ctx.fillStyle="rgba(0,0,0,.7)";
    ctx.beginPath(); 
    ctx.arc(x-4, y-solo.keeper.h/2-solo.keeper.headR+1, 1.5, 0, Math.PI*2); 
    ctx.fill();
    ctx.beginPath(); 
    ctx.arc(x+4, y-solo.keeper.h/2-solo.keeper.headR+1, 1.5, 0, Math.PI*2); 
    ctx.fill();

    // Arms with gloves
    ctx.strokeStyle="rgba(226,232,240,.96)";
    ctx.lineWidth=7; 
    ctx.lineCap="round";
    const arm=solo.keeper.diveT*22;
    const armBend = Math.sin(solo.keeper.diveT*Math.PI)*8;
    ctx.beginPath();
    ctx.moveTo(x-solo.keeper.w*0.20, y);
    ctx.lineTo(x-solo.keeper.w*0.55-arm, y-2-armBend);
    ctx.moveTo(x+solo.keeper.w*0.20, y);
    ctx.lineTo(x+solo.keeper.w*0.55-arm, y-2-armBend);
    ctx.stroke();

    // Gloves with glow
    ctx.shadowColor="rgba(255,255,255,.4)";
    ctx.shadowBlur=8;
    ctx.fillStyle="rgba(255,255,255,.98)";
    ctx.beginPath(); 
    ctx.arc(x-solo.keeper.w*0.60-arm, y-2-armBend, 9, 0, Math.PI*2); 
    ctx.fill();
    ctx.beginPath(); 
    ctx.arc(x+solo.keeper.w*0.60-arm, y-2-armBend, 9, 0, Math.PI*2); 
    ctx.fill();
    ctx.shadowBlur=0;

    // Enhanced particles
    for(const p of solo.particles){
      ctx.globalAlpha=Math.max(0,p.a)*0.95;
      ctx.fillStyle=p.color || "rgba(255,255,255,.95)";
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size||3, 0, Math.PI*2);
      ctx.fill();
    }
    ctx.globalAlpha=1;

    // Enhanced ball trail
    for(let i=0; i<solo.ball.trail.length; i++){
      const t = solo.ball.trail[i];
      const alpha = (t.a||0.4)*0.6;
      const size = solo.ball.r + 10 - (i*0.3);
      ctx.globalAlpha=alpha;
      const trailGrad = ctx.createRadialGradient(t.x,t.y,0,t.x,t.y,size);
      trailGrad.addColorStop(0,"rgba(34,197,94,.3)");
      trailGrad.addColorStop(1,"transparent");
      ctx.fillStyle=trailGrad;
      ctx.beginPath(); 
      ctx.arc(t.x,t.y, size, 0, Math.PI*2);
      ctx.fill();
    }
    ctx.globalAlpha=1;

    drawSoccerBall(solo.ball.x, solo.ball.y, solo.ball.r, solo.ball.spin);

    if(drag.active){
      const dx = drag.start.x - drag.now.x;
      const dy = drag.start.y - drag.now.y;
      const mag = Math.hypot(dx,dy);
      const pwr = clamp(mag, 0, 650);

      // Enhanced power indicator with glow
      ctx.globalAlpha=0.9;
      const powerColor = pwr>500 ? "rgba(239,68,68,.95)" : pwr>350 ? "rgba(249,115,22,.95)" : "rgba(163,230,53,.95)";
      ctx.strokeStyle = powerColor;
      ctx.lineWidth=5;
      ctx.shadowColor=powerColor;
      ctx.shadowBlur=12;
      ctx.beginPath();
      ctx.arc(solo.ball.x, solo.ball.y, 20 + pwr*0.032, 0, Math.PI*2);
      ctx.stroke();
      
      // Inner ring
      ctx.lineWidth=3;
      ctx.globalAlpha=0.6;
      ctx.beginPath();
      ctx.arc(solo.ball.x, solo.ball.y, 16 + pwr*0.025, 0, Math.PI*2);
      ctx.stroke();
      ctx.shadowBlur=0;
      ctx.globalAlpha=1;

      // Enhanced trajectory line with gradient
      const trajGrad = ctx.createLinearGradient(solo.ball.x, solo.ball.y, drag.now.x, drag.now.y);
      trajGrad.addColorStop(0, "rgba(255,255,255,.95)");
      trajGrad.addColorStop(1, "rgba(255,255,255,.3)");
      ctx.strokeStyle=trajGrad;
      ctx.lineWidth=3;
      ctx.setLineDash([8,8]);
      ctx.lineCap="round";
      ctx.shadowColor="rgba(255,255,255,.5)";
      ctx.shadowBlur=8;
      ctx.beginPath();
      ctx.moveTo(solo.ball.x, solo.ball.y);
      ctx.lineTo(drag.now.x, drag.now.y);
      ctx.stroke();
      ctx.shadowBlur=0;
      ctx.setLineDash([]);
    }
  }

  // ==================== PVP (Enhanced two-player) ====================
  const pvp = {
    ball:{x:0,y:0,r:12,vx:0,vy:0,spin:0,trail:[]},
    p1:{x:0,y:0,r:20},
    p2:{x:0,y:0,r:20},
    s1:0,s2:0,
    maxGoals:7,
    ended:false,
    particles:[]
  };

  let pvpGoalCount=0;

  function pvpResetField(){
    pvp.ball.x=W/2; pvp.ball.y=H/2;
    pvp.ball.vx=0; pvp.ball.vy=0; pvp.ball.spin=0; pvp.ball.trail.length=0;
    pvp.p1.x=W/2; pvp.p1.y=H*0.78;
    pvp.p2.x=W/2; pvp.p2.y=H*0.22;
    pvp.particles.length=0;
  }

  function pvpResetAll(){
    pvp.s1=0; pvp.s2=0; pvp.ended=false;
    pvpGoalCount=0;
    pvpResetField();
  }

  function pvpKick(player, impulse){
    const d=dist(pvp.ball.x,pvp.ball.y,player.x,player.y);
    const minD=pvp.ball.r+player.r;
    if(d<minD){
      const nx=(pvp.ball.x-player.x)/(d||1);
      const ny=(pvp.ball.y-player.y)/(d||1);
      const overlap=(minD-d)+0.8;
      pvp.ball.x+=nx*overlap; pvp.ball.y+=ny*overlap;

      pvp.ball.vx += nx*impulse;
      pvp.ball.vy += ny*impulse;

      pvp.ball.spin += nx*0.6;

      // Kick particles
      for(let i=0;i<15;i++){
        const angle = Math.atan2(ny,nx) + (Math.random()*0.8-0.4);
        pvp.particles.push({
          x:pvp.ball.x,y:pvp.ball.y,
          vx:-Math.cos(angle)*(2+Math.random()*3),
          vy:-Math.sin(angle)*(2+Math.random()*3),
          a:1, life:0.5+Math.random()*0.5,
          size:2+Math.random()*3
        });
      }

      sfxKick(); vibr(10);
      hideAd();
    }
  }

  function pvpGoal(whose){
    if(pvp.ended) return;
    if(whose===1) {
      pvp.s1++; 
      ui.p1Pill.classList.add('pulse');
      setTimeout(()=>ui.p1Pill.classList.remove('pulse'), 500);
    }
    else {
      pvp.s2++;
      ui.p2Pill.classList.add('pulse');
      setTimeout(()=>ui.p2Pill.classList.remove('pulse'), 500);
    }

    pvpGoalCount++;
    if(pvpGoalCount%2===0) showAd();

    goalHype(whose===1 ? "Ú¯Ù„ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒÚ©Ù† Û± ğŸŸ¢âš½" : "Ú¯Ù„ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒÚ©Ù† Û² ğŸ”µâš½");

    if(pvp.s1>=pvp.maxGoals || pvp.s2>=pvp.maxGoals){
      pvp.ended=true;
      running=false; paused=true; inEndScreen=true;

      const winner = (pvp.s1>pvp.s2) ? "Ø¨Ø§Ø²ÛŒÚ©Ù† Û± ğŸŸ¢" : "Ø¨Ø§Ø²ÛŒÚ©Ù† Û² ğŸ”µ";
      openOverlay("Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ ğŸ‰", `${winner} Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯! ğŸ† (${pvp.s1} - ${pvp.s2})`, "end");
      if(ADS.showOnWin) showAd();
      return;
    }

    pvpResetField();
  }

  function pvpUpdate(dt){
    timeLeft -= dt;
    if(timeLeft<=0){
      timeLeft=0; running=false; paused=true; inEndScreen=true;
      let title="Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ â±";
      let msg;
      if(pvp.s1===pvp.s2) msg=`Ù…Ø³Ø§ÙˆÛŒ! ğŸ¤ (${pvp.s1} - ${pvp.s2})`;
      else msg=`Ø¨Ø±Ù†Ø¯Ù‡: ${(pvp.s1>pvp.s2)?"Ø¨Ø§Ø²ÛŒÚ©Ù† Û± ğŸŸ¢":"Ø¨Ø§Ø²ÛŒÚ©Ù† Û² ğŸ”µ"} ğŸ† (${pvp.s1} - ${pvp.s2})`;
      openOverlay(title, msg, "end");
      if(ADS.showOnTimeEnd) showAd();
      return;
    }

    // Update particles
    for(let i=pvp.particles.length-1;i>=0;i--){
      const p=pvp.particles[i];
      p.life-=dt;
      p.x += p.vx*(dt*60);
      p.y += p.vy*(dt*60);
      p.vy += 0.18*(dt*60);
      p.a *= 0.94;
      if(p.life<=0) pvp.particles.splice(i,1);
    }

    pvpKick(pvp.p1, 7.5);
    pvpKick(pvp.p2, 7.5);

    pvp.ball.x += pvp.ball.vx*(dt*60);
    pvp.ball.y += pvp.ball.vy*(dt*60);

    pvp.ball.vx += pvp.ball.spin * 0.012 * (dt*60);
    pvp.ball.spin *= 0.99;

    pvp.ball.vx *= 0.985;
    pvp.ball.vy *= 0.985;

    pvp.ball.trail.push({x:pvp.ball.x,y:pvp.ball.y,a:1});
    if(pvp.ball.trail.length>26) pvp.ball.trail.shift();
    for(const t of pvp.ball.trail) t.a*=0.90;

    const gx1=(W-S.pvpGoalW)/2;
    const gx2=gx1+S.pvpGoalW;

    const topMouth = S.margin + S.pvpGoalH;
    const botMouth = H - S.margin - S.pvpGoalH;

    if(pvp.ball.x>gx1+8 && pvp.ball.x<gx2-8){
      if(pvp.ball.y - pvp.ball.r <= topMouth && pvp.ball.vy < 0){
        pvpGoal(1); return;
      }
      if(pvp.ball.y + pvp.ball.r >= botMouth && pvp.ball.vy > 0){
        pvpGoal(2); return;
      }
    }

    const minX=S.margin+pvp.ball.r, maxX=W-S.margin-pvp.ball.r;
    const minY=S.margin+pvp.ball.r, maxY=H-S.margin-pvp.ball.r;

    if(pvp.ball.x<minX){ pvp.ball.x=minX; pvp.ball.vx*=-0.90; pvp.ball.spin*=-0.65; }
    if(pvp.ball.x>maxX){ pvp.ball.x=maxX; pvp.ball.vx*=-0.90; pvp.ball.spin*=-0.65; }

    const inGoalX = (pvp.ball.x>=gx1 && pvp.ball.x<=gx2);
    if(pvp.ball.y<minY && !inGoalX){ pvp.ball.y=minY; pvp.ball.vy*=-0.90; }
    if(pvp.ball.y>maxY && !inGoalX){ pvp.ball.y=maxY; pvp.ball.vy*=-0.90; }
  }

  function pvpDraw(){
    drawField();

    // Enhanced center line
    ctx.globalAlpha=0.6;
    ctx.beginPath(); 
    ctx.moveTo(18,H/2); 
    ctx.lineTo(W-18,H/2);
    ctx.strokeStyle="rgba(255,255,255,.75)";
    ctx.lineWidth=2.5; 
    ctx.shadowColor="rgba(255,255,255,.3)";
    ctx.shadowBlur=6;
    ctx.stroke();
    ctx.shadowBlur=0;
    ctx.globalAlpha=1;

    const gx1=(W-S.pvpGoalW)/2;

    drawGoalFrame({x:gx1,y:S.margin,w:S.pvpGoalW,h:S.pvpGoalH,depth:S.pvpGoalDepth,flip:true,glow:"rgba(59,130,246,.3)"});
    drawGoalFrame({x:gx1,y:H-S.margin-S.pvpGoalH,w:S.pvpGoalW,h:S.pvpGoalH,depth:S.pvpGoalDepth,flip:false,glow:"rgba(34,197,94,.3)"});

    // Particles
    for(const p of pvp.particles){
      ctx.globalAlpha=Math.max(0,p.a)*0.9;
      ctx.fillStyle="rgba(255,255,255,.95)";
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size||3, 0, Math.PI*2);
      ctx.fill();
    }
    ctx.globalAlpha=1;

    // Enhanced ball trail
    for(let i=0; i<pvp.ball.trail.length; i++){
      const t = pvp.ball.trail[i];
      const alpha = (t.a||0.4)*0.6;
      const size = pvp.ball.r + 9 - (i*0.3);
      ctx.globalAlpha=alpha;
      const trailGrad = ctx.createRadialGradient(t.x,t.y,0,t.x,t.y,size);
      trailGrad.addColorStop(0,"rgba(59,130,246,.3)");
      trailGrad.addColorStop(1,"transparent");
      ctx.fillStyle=trailGrad;
      ctx.beginPath(); 
      ctx.arc(t.x,t.y, size, 0, Math.PI*2);
      ctx.fill();
    }
    ctx.globalAlpha=1;

    drawSoccerBall(pvp.ball.x,pvp.ball.y,pvp.ball.r,pvp.ball.spin);

    function drawPlayer(pl, fill, label, glow){
      ctx.save();
      
      // Enhanced shadow
      ctx.globalAlpha=0.25;
      ctx.fillStyle="#000";
      ctx.beginPath(); 
      ctx.ellipse(pl.x,pl.y+pl.r+5,pl.r*0.85,pl.r*0.35,0,0,Math.PI*2); 
      ctx.fill();
      ctx.globalAlpha=1;
      
      // Glow effect
      ctx.shadowColor=glow;
      ctx.shadowBlur=15;
      ctx.fillStyle=fill;
      ctx.beginPath(); 
      ctx.arc(pl.x,pl.y,pl.r,0,Math.PI*2); 
      ctx.fill();
      ctx.shadowBlur=0;

      // Highlight
      ctx.globalAlpha=0.25;
      ctx.fillStyle="#fff";
      ctx.beginPath(); 
      ctx.arc(pl.x-7,pl.y-7,pl.r*0.6,0,Math.PI*2); 
      ctx.fill();
      ctx.globalAlpha=1;

      // Number badge
      ctx.fillStyle="rgba(0,0,0,.5)";
      ctx.beginPath(); 
      ctx.arc(pl.x,pl.y,pl.r*0.6,0,Math.PI*2); 
      ctx.fill();
      
      ctx.fillStyle="rgba(255,255,255,.98)";
      ctx.font="900 14px system-ui";
      ctx.textAlign="center"; 
      ctx.textBaseline="middle";
      ctx.shadowColor="rgba(0,0,0,.4)";
      ctx.shadowBlur=4;
      ctx.fillText(label, pl.x, pl.y+1);
      ctx.shadowBlur=0;

      ctx.restore();
    }

    drawPlayer(pvp.p1,"rgba(34,197,94,.95)","1","rgba(34,197,94,.6)");
    drawPlayer(pvp.p2,"rgba(59,130,246,.95)","2","rgba(59,130,246,.6)");
  }

  // ==================== Input ====================
  const drag={active:false,start:null,now:null};
  const pointers=new Map();

  cv.addEventListener("pointerdown",(e)=>{
    if(!running || paused) return;
    cv.setPointerCapture(e.pointerId);
    const p=toLocal(e);

    if(mode===MODES.solo){
      if(dist(p.x,p.y,solo.ball.x,solo.ball.y) <= solo.ball.r+38){
        drag.active=true; drag.start={...p}; drag.now={...p};
        ui.powerMeter.classList.add('show');
      }
      return;
    }

    if(p.y > H/2){
      pointers.set(e.pointerId,{who:"p1"});
      pvp.p1.x=clamp(p.x, S.margin+pvp.p1.r, W-S.margin-pvp.p1.r);
      pvp.p1.y=clamp(p.y, H/2+pvp.p1.r, H-S.margin-pvp.p1.r);
    }else{
      pointers.set(e.pointerId,{who:"p2"});
      pvp.p2.x=clamp(p.x, S.margin+pvp.p2.r, W-S.margin-pvp.p2.r);
      pvp.p2.y=clamp(p.y, S.margin+pvp.p2.r, H/2-pvp.p2.r);
    }
  });

  cv.addEventListener("pointermove",(e)=>{
    if(!running || paused) return;
    const p=toLocal(e);

    if(mode===MODES.solo){
      if(!drag.active) return;
      drag.now={...p};
      
      const dx = drag.start.x - drag.now.x;
      const dy = drag.start.y - drag.now.y;
      const mag = Math.hypot(dx,dy);
      const pwr = clamp(mag, 0, 650);
      const percent = clamp((pwr/650)*100, 0, 100);
      ui.powerBar.style.width = percent + '%';
      
      return;
    }

    const info=pointers.get(e.pointerId);
    if(!info) return;

    if(info.who==="p1"){
      pvp.p1.x=clamp(p.x, S.margin+pvp.p1.r, W-S.margin-pvp.p1.r);
      pvp.p1.y=clamp(p.y, H/2+pvp.p1.r, H-S.margin-pvp.p1.r);
    }else{
      pvp.p2.x=clamp(p.x, S.margin+pvp.p2.r, W-S.margin-pvp.p2.r);
      pvp.p2.y=clamp(p.y, S.margin+pvp.p2.r, H/2-pvp.p2.r);
    }
  });

  function endPointer(pid){
    pointers.delete(pid);
    try{ cv.releasePointerCapture(pid); }catch(_){}
  }

  cv.addEventListener("pointerup",(e)=>{
    if(mode===MODES.solo){
      if(!drag.active) return;
      drag.active=false;
      
      ui.powerMeter.classList.remove('show');
      ui.powerBar.style.width = '0%';

      const end=toLocal(e);
      drag.now=end;

      const dx = (drag.start.x - end.x);
      const dy = (drag.start.y - end.y);
      const mag = Math.hypot(dx,dy);

      drag.start=null;
      soloShoot(dx,dy,mag);
      return;
    }
    endPointer(e.pointerId);
  });

  cv.addEventListener("pointercancel",(e)=>{
    drag.active=false; drag.start=null; drag.now=null;
    ui.powerMeter.classList.remove('show');
    ui.powerBar.style.width = '0%';
    endPointer(e.pointerId);
  });

  // ==================== Mode & UI ====================
  function syncUI(){
    ui.pauseBtn.textContent = paused ? "â–¶ï¸" : "â¸";
    ui.soundBtn.textContent = soundOn ? "ğŸ”Š" : "ğŸ”‡";
    ui.time.textContent = String(Math.max(0, Math.ceil(timeLeft)));

    if(mode===MODES.solo){
      ui.modeLabel.textContent="Ù¾Ù†Ø§Ù„ØªÛŒ";
      ui.p2Pill.style.display="none";
      ui.streakPill.style.display="";
      ui.p1Pill.querySelector(".tiny").textContent="Ø§Ù…ØªÛŒØ§Ø²";
      ui.p1Score.textContent = String(solo.score);
      ui.goals.textContent = String(solo.goals);
      ui.streak.textContent = String(solo.streak);
    }else{
      ui.modeLabel.textContent="Ø¯ÙˆÙ†ÙØ±Ù‡";
      ui.p2Pill.style.display="";
      ui.streakPill.style.display="none";
      ui.p1Pill.querySelector(".tiny").textContent="Ø¨Ø§Ø²ÛŒÚ©Ù† Û±";
      ui.p1Score.textContent = String(pvp.s1);
      ui.p2Score.textContent = String(pvp.s2);
      ui.goals.textContent = String(pvp.s1 + pvp.s2);
    }
  }

  function setMode(m){
    mode=m;
    ui.modeBtns.forEach(b=>b.classList.toggle("active", b.dataset.mode===m));
    paused=false; running=true; inEndScreen=false;
    closeOverlay(); hideAd();

    timeLeft=60;

    if(mode===MODES.solo){
      soloResetAll();
      ui.hint.innerHTML = `Ù¾Ù†Ø§Ù„ØªÛŒ: Ø±ÙˆÛŒ ØªÙˆÙ¾ Ù„Ù…Ø³ Ú©Ù† â†’ <b>Ø¨Ù‡ Ù¾Ø§ÛŒÛŒÙ† Ø¨Ú©Ø´ Ùˆ Ø±Ù‡Ø§ Ú©Ù†</b>. Ú¯ÙˆØ´Ù‡â€ŒÙ‡Ø§ + Ø³Ø±Ø¹Øª Ø¨Ø§Ù„Ø§ = Ú¯Ù„ ØªØ¶Ù…ÛŒÙ†ÛŒ ğŸ”¥`;
      toast("ğŸ¯ Ø­Ø§Ù„Øª Ù¾Ù†Ø§Ù„ØªÛŒ ÙØ¹Ø§Ù„ Ø´Ø¯");
    }else{
      pvpResetAll();
      ui.hint.innerHTML = `ğŸ‘¥ Ø¯ÙˆÙ†ÙØ±Ù‡: ğŸŸ¢ Ù¾Ø§ÛŒÛŒÙ† / ğŸ”µ Ø¨Ø§Ù„Ø§. Ù‡Ø±Ø¬Ø§ ØªÙˆ Ù†ÛŒÙ…Ù‡ Ø®ÙˆØ¯Øª Ù„Ù…Ø³ Ú©Ù†ÛŒ Ú©Ù†ØªØ±Ù„ Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒ. Ø§ÙˆÙ„ÛŒÙ† Ù†ÙØ± Ø¨Ù‡ ${pvp.maxGoals} Ú¯Ù„ Ø¨Ø±Ù†Ø¯Ù‡ Ø§Ø³Øª! ğŸ†`;
      toast("ğŸ‘¥ Ø­Ø§Ù„Øª Ø¯ÙˆÙ†ÙØ±Ù‡ ÙØ¹Ø§Ù„ Ø´Ø¯");
    }
    syncUI();
  }

  ui.modeBtns.forEach(b=>b.addEventListener("click", ()=>setMode(b.dataset.mode)));

  ui.restartBtn.addEventListener("click", ()=>{
    resize();
    setMode(mode);
  });

  // ==================== Loop ====================
  function tick(now){
    const dt = Math.min(0.033, (now-lastT)/1000) * slowmo;
    lastT=now;

    if(running && !paused){
      if(mode===MODES.solo) soloUpdate(dt);
      else pvpUpdate(dt);
      syncUI();
    }

    ctx.clearRect(0,0,W,H);
    if(mode===MODES.solo) soloDraw(drag);
    else pvpDraw();

    requestAnimationFrame(tick);
  }

  // ==================== Boot ====================
  resize();
  setMode(MODES.solo);
  requestAnimationFrame(tick);

})();
</script>
</body>
</html>
